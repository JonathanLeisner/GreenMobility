For questions regarding these codes, please contact
Rafael Dix-Carneiro at rafael.dix.carneiro@duke.edu or
dix-carneiro@econ.umd.edu

==============================================
MPI/Fortran Codes for the simulation exercises
==============================================

Main.f90 (Main program, reads data)
Global_Data.f90 (Global variables are dfined)
Simulation_MOD1.f90 (perfect capital mobility)
Simulation_MOD2.f90 (no capital mobility)
Simulation_MOD3.f90 (imperfect capital mobility)
Parallel_Emax_MOD.f90 (Computes Emax)
ParallelCohorts_MOD.f90 (Computes aggregate supply of human capital)
NewtonSolver.f90 (Nonlinear solver)
LinReg_MOD.f90 (Linear regression routine)
Welfare.f90 (Computes welfare)

=========================================
MPI and Intel Fortran Compilation command
=========================================
mpif90 NewtonSolver.f90 Global_Data.f90 LinReg_MOD.f90 Parallel_Emax_MOD.f90 Welfare.f90 
ParallelCohorts_MOD.f90 Simulation_MOD1.F90 Simulation_MOD2.F90 Simulation_MOD3.F90 
Main.f90 -o simulation -L$LIBRARY_PATH -I$INCLUDE -Wl,--start-group -lmkl_intel_lp64 
-lmkl_intel_thread -lmkl_core -Wl,--end-group -liomp5 -lpthread -openmp -heap-arrays

========
PBS file
========
#PBS -N Job_Simulation
#PBS -o PBS_out
#PBS -e PBS_error
#PBS -l nodes=2:ppn=12,walltime=00:12:00
#PBS -m abe
#PBS -M dix-carneiro@econ.umd.edu

export OMP_NUM_THREADS=1

cd /home/rdc/Simulation

mpiexec -np 24 ./simulation > simulation_out

==============
IMPORTANT NOTE
==============
The paralleization is set in a way that the program will only work if it
uses 24 cores, as is illustrated in the PBS file above.

======
OUTPUT
======
Part of the output of the program is illustrated below (simulation starts in year 
2005 and finishes in year 2305).


 ************************
 Computing Emax Myopic...
 ************************
 
 
 ***********************************
 Emax Myopic Computed
 ***********************************
 
 Min and Max R_sq for Emax:
  0.943364455150758               33           5           2           4
           2
  0.999990846304487               35           3           2           1
           3
        2005
 
 
 RE Iteration:           1
 
 rK:
  0.109799999206947     
 
 rsk Ed=0:
   1.28211412511927        1.57234123726961        2.06458286499183     
   1.66271308807491        1.62792105081517        1.88319846295894     
   1.93002489403725     
 
 rsk Ed=1:
   2.05325524462995        3.01379408254068        3.98706247649319     
   2.95286821376409        3.22281281754693        3.72906869710197     
   3.95323406370446     
 
 Employment:
  6.035656505617377E-002  0.137757821176274       3.989321804768365E-002
  5.242262413663862E-002  0.157432884860148       6.044552603247589E-002
  0.491691314372753     
 
 Fraction ZERO Sector:
  0.386785564720421     
 
 Capital Stock:
   6515903.72163188     
 
 Welfare:
   3020443.11643938     
 
 Prices NT:
   1.01448873612413        1.04527163607944        1.00553212993656     
   1.10603675376681     
 
 iter:
          74
 
 iter2:
           1
 
 check1:
  1.050036923219699E-005  4.902437563419904E-005  7.011034806603256E-006
  4.075431047079192E-006  1.774113240338160E-005  1.003317920689195E-005
  1.347737626689050E-005  4.668155584630629E-005  3.606064935235409E-005
  5.047268260005566E-006  2.744863206149972E-005  1.485247571975101E-005
  1.565165475669872E-006  1.076584780479450E-005
 
 check2:
  7.222708209297934E-009
 
 check3:
  3.013106730278582E-005  2.321578437908950E-005  1.431321743942601E-005
  1.043255325047787E-005
 
 
 ================================================================
 ================================================================
        2006
 
 
 RE Iteration:           1
 
 rK:
  0.109800016031217     
 
 rsk Ed=0:
   1.34062472521294        1.60202906484052        2.08789016560776     
   1.67724163023449        1.64452953747386        1.88500214194720     
   1.91696272436421     
 
 rsk Ed=1:
   2.04567361681975        3.02631355309974        4.03778382491768     
   2.95768969407620        3.24801372424149        3.68022390232856     
   3.93713006512229     
 
 Employment:
  6.001015112391897E-002  0.136938231319234       3.856846490298554E-002
  5.210405080478200E-002  0.153939541444344       6.353680567507944E-002
  0.494902734707413     
 
 Fraction ZERO Sector:
  0.373992888129092     
 
 Capital Stock:
   6891799.57592364     
 
 Welfare:
   3190649.24925695     
 
 Prices NT:
   1.01041075680019        1.04343691961717       0.995798618516842     
   1.09413273900214     
 
 iter:
          44
 
 iter2:
           1
 
 check1:
  4.620029190716135E-005  1.595154619671302E-005  1.708754200424600E-005
  2.870066507232316E-006  1.202329697358451E-005  4.606222115732805E-006
  1.921959573270016E-006  4.256590773432656E-005  3.719744425545457E-005
  4.619386372484158E-005  1.670759434846403E-005  1.376750241166569E-005
  2.414423139196487E-006  5.861205301549433E-006
 
 check2:
  1.532264923831406E-007
 
 check3:
  2.003193134991928E-005  2.642851186389350E-006  1.281736644048216E-005
  1.140773468782941E-005
 
 
 ================================================================
 ================================================================
        2007
 
 
 RE Iteration:           1
 
 rK:
  0.109799821137406     
 
 rsk Ed=0:
   1.38058840799544        1.62168371671908        2.12011715334322     
   1.68990835622222        1.66516680842805        1.89363979913101     
   1.90887987916935     
 
 rsk Ed=1:
   2.05228631464977        3.03977219573442        4.05861646140031     
   3.00947182807275        3.30667041595470        3.64687199355731     
   3.91625973407973     
 
 Employment:
  6.034877954142293E-002  0.134961481902906       3.783620932040930E-002
  5.202159147215527E-002  0.151671911721858       6.577007851682463E-002
  0.497389966159402     
 
 Fraction ZERO Sector:
  0.365229940403178     
 
 Capital Stock:
   7233632.80400725     
 
 Welfare:
   3316376.84660491     
 
 Prices NT:
   1.00954300982231        1.04710530247301       0.989454331103057     
   1.08406294979435     
 
 iter:
          47
 
 iter2:
           1
 
 check1:
  6.253096857478102E-006  1.665672322403999E-006  2.042842247806931E-006
  3.926251833652472E-007  7.177339927944004E-007  2.768743860737111E-006
  1.594128070103729E-006  4.537082396460779E-005  8.683472469739328E-006
  3.502333746352448E-006  1.801108267929230E-005  1.367364375792768E-005
  6.315940912493545E-007  4.155868893462866E-007
 
 check2:
  1.774990480818417E-006
 
 check3:
  8.484323094786611E-006  7.300556865708074E-006  1.857478781713308E-005
  6.036740304998789E-006
 
 
 ================================================================
 ================================================================
        2008
 
 
 RE Iteration:           1
 
 rK:
  0.109802183075788     
 
 rsk Ed=0:
   1.40246034538733        1.63301778097861        2.14937473721168     
   1.69693239391310        1.67928954329947        1.90453430608371     
   1.90296036839283     
 
 rsk Ed=1:
   2.04798161455409        3.04205732081653        4.05466381303439     
   2.97084543296134        3.34093399097359        3.65037617920424     
   3.90481941266379     
 
 Employment:
  6.132186080354204E-002  0.132269746039102       3.784611625185613E-002
  5.228713051622606E-002  0.149798138025910       6.728541987864653E-002
  0.499191567887955     
 
 Fraction ZERO Sector:
  0.360180677146455     
 
 Capital Stock:
   7531944.56930919     
 
 Welfare:
   3438378.85477553     
 
 Prices NT:
   1.00702254715534        1.05005834557657       0.988110676572870     
   1.07874859809824     
 
 iter:
          32
 
 iter2:
           1
 
 check1:
  3.141815762386369E-005  1.695313040250834E-005  2.361413568763293E-005
  4.327683571725416E-006  2.047692761553144E-005  4.813993742858180E-006
  6.770002409117737E-006  1.023208117745256E-005  3.761435906746158E-006
  4.718391985347736E-006  2.925072941861728E-005  1.644670530276393E-005
  1.935125022445305E-007  7.434238800119175E-006
 
 check2:
  2.151108219416997E-005
 
 check3:
  1.950263934028668E-005  2.295993660869633E-005  3.243794610129774E-005
  4.157319936362591E-005
 
 
 ================================================================
 ================================================================
        2009
 
 
 RE Iteration:           1
 
 rK:
  0.109797318327421     
 
 rsk Ed=0:
   1.40745366010060        1.64256618044669        2.15792217238067     
   1.69276257894845        1.68444058697798        1.90685729719069     
   1.90738135200768     
 
 rsk Ed=1:
   2.04542617636169        3.02633908969981        4.05109267879601     
   2.95729424433788        3.38818408591521        3.63006692476072     
   3.89690174562202     
 
 Employment:
  6.215636126745584E-002  0.129865689756830       3.835014284271750E-002
  5.242694854442006E-002  0.148965958075016       6.839735353755658E-002
  0.499837543173835     
 
 Fraction ZERO Sector:
  0.356453147647272     
 
 Capital Stock:
   7804670.70365760     
 
 Welfare:
   3542252.78639640     
 
 Prices NT:
   1.00533620689307        1.05444342230599       0.986543185304061     
   1.07732716051679     
 
 iter:
          25
 
 iter2:
           3
 
 check1:
  6.740371065183659E-006  3.343049685744504E-006  2.249172670332200E-006
  1.834182970261722E-005  2.181809565693360E-005  5.268499014832173E-008
  2.182587425636484E-005  4.334657085858229E-005  1.385149405219721E-005
  1.113154792919957E-005  2.458927217929840E-005  3.455068583013698E-005
  3.210467619751967E-006  1.018148259590568E-005
 
 check2:
  2.644599928114388E-005
 
 check3:
  4.301507353991416E-005  3.373237955461850E-005  1.659103362451619E-006
  1.596115645144391E-005
 
 
 ================================================================
 ================================================================
        2010
 
 
 RE Iteration:           1
 
 rK:
  0.109803539720738     
 
 rsk Ed=0:
   1.42964608971031        1.65821370373705        2.16773378171394     
   1.69922050807141        1.69419681743027        1.91215269588099     
   1.89925505260224     
 
 rsk Ed=1:
   2.04978603727072        3.02322129368679        4.07080032558334     
   2.98508890304971        3.41594084178487        3.60201109565015     
   3.89012929439778     
 
 Employment:
  6.274497748629844E-002  0.127901703291540       3.831789321680214E-002
  5.240608668238887E-002  0.148464904228003       6.924653267241189E-002
  0.500917935631996     
 
 Fraction ZERO Sector:
  0.355109354697998     
 
 Capital Stock:
   8064226.39265436     
 
 Welfare:
   3655876.47589341     
 
 Prices NT:
   1.00482770569804        1.05569735062729       0.982471305595142     
   1.07234070344896     
 
 iter:
          32
 
 iter2:
           1
 
 check1:
  1.570672964279485E-005  1.567743922259446E-005  9.015666647571585E-006
  2.100618734357518E-005  8.910104786208350E-006  1.157779177396456E-005
  8.755453106190636E-006  1.220658988720924E-005  7.010199595258726E-006
  4.841803187272120E-006  1.516051322925094E-006  1.301540368503495E-005
  1.571380638942799E-006  3.303006672172870E-006
 
 check2:
  3.485736470487666E-005
 
 check3:
  2.306684754046790E-005  3.542893863126700E-005  3.944644767842759E-005
  3.492298217680490E-005
 
 
 ================================================================
 ================================================================
